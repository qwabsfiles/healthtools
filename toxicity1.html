<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Toxicity Risk Prediction</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'primary': {
                            50: '#ecfeff',
                            100: '#cffafe', 
                            200: '#a5f3fc',
                            300: '#67e8f9',
                            400: '#22d3ee',
                            500: '#06b6d4',
                            600: '#0891b2',
                            700: '#0e7490',
                            800: '#155e75',
                            900: '#164e63'
                        },
                        'secondary': {
                            50: '#f5f3ff',
                            100: '#ede9fe',
                            200: '#ddd6fe',
                            300: '#c4b5fd',
                            400: '#a78bfa',
                            500: '#8b5cf6',
                            600: '#7c3aed',
                            700: '#6d28d9',
                            800: '#5b21b6',
                            900: '#4c1d95'
                        },
                        'accent': {
                            50: '#fff7ed',
                            100: '#ffedd5',
                            200: '#fed7aa',
                            300: '#fdba74',
                            400: '#fb923c',
                            500: '#f97316',
                            600: '#ea580c',
                            700: '#c2410c',
                            800: '#9a3412',
                            900: '#7c2d12'
                        },
                        'success': {
                            50: '#ecfdf5',
                            100: '#d1fae5',
                            200: '#a7f3d0',
                            300: '#6ee7b7',
                            400: '#34d399',
                            500: '#10b981',
                            600: '#059669',
                            700: '#047857',
                            800: '#065f46',
                            900: '#064e3b'
                        }
                    }
                }
            }
        }
    </script>
</head>
<body class="bg-slate-50 text-slate-800 font-sans leading-relaxed">
    <!-- Header -->
    <header class="bg-gradient-to-br from-rose-500 via-rose-600 to-rose-700 text-white shadow-2xl relative overflow-hidden">
        <div class="absolute inset-0 opacity-10">
            <svg class="w-full h-full" viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">
                <defs>
                    <pattern id="grid" width="10" height="10" patternUnits="userSpaceOnUse">
                        <path d="M 10 0 L 0 0 0 10" fill="none" stroke="currentColor" stroke-width="0.5"/>
                    </pattern>
                </defs>
                <rect width="100" height="100" fill="url(#grid)" />
            </svg>
        </div>
        
        <div class="container mx-auto px-4 py-12 relative z-10">
            <div class="text-center max-w-4xl mx-auto">
                <div class="inline-flex items-center justify-center w-20 h-20 bg-white bg-opacity-20 rounded-2xl mb-6 backdrop-blur-sm">
                    <svg class="w-10 h-10 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z"></path>
                    </svg>
                </div>
                <h1 class="text-4xl md:text-5xl lg:text-6xl font-bold mb-4 bg-gradient-to-r from-white to-rose-100 bg-clip-text text-transparent">
                    Toxicity Risk Prediction
                </h1>
                <p class="text-rose-100 text-xl md:text-2xl opacity-90 font-medium">
                    Advanced risk assessment and safety monitoring
                </p>
                <div class="mt-8 flex justify-center">
                    <a href="index.html" class="bg-white bg-opacity-20 hover:bg-opacity-30 px-6 py-3 rounded-full backdrop-blur-sm transition-all duration-300 font-semibold">
                        ‚Üê Back to Home
                    </a>
                </div>
            </div>
        </div>
    </header>

    <div class="container mx-auto px-4 py-12 max-width-4xl">
        <div class="bg-white rounded-2xl shadow-xl border border-slate-200 p-8 md:p-10 lg:p-12 relative overflow-hidden">
            <!-- Decorative Background -->
            <div class="absolute top-0 right-0 w-32 h-32 bg-gradient-to-br from-rose-100 to-secondary-100 rounded-full -translate-y-16 translate-x-16 opacity-50"></div>
            
            <form id="toxicity-form" class="relative z-10">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <!-- Form fields with modern styling -->
                    <div class="form-group">
                        <label for="comorbs" class="block text-sm font-semibold text-slate-700 mb-2">Comorbidities (0 = None, 1 = Present):</label>
                        <input type="number" id="comorbs" value="0" min="0" max="1" class="w-full px-4 py-3 border border-slate-300 rounded-xl focus:ring-2 focus:ring-primary-500 focus:border-primary-500 transition-all duration-300">
                    </div>
                    
                    <div class="form-group">
                        <label for="age_cd" class="block text-sm font-semibold text-slate-700 mb-2">Age Category:</label>
                        <select id="age_cd" class="w-full px-4 py-3 border border-slate-300 rounded-xl focus:ring-2 focus:ring-primary-500 focus:border-primary-500 transition-all duration-300">
                            <option value="1">Under 45</option>
                            <option value="2">45-54</option>
                            <option value="3">55-64</option>
                            <option value="4">65-74</option>
                            <option value="5">75-84</option>
                            <option value="6">85+</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="eth_cd" class="block text-sm font-semibold text-slate-700 mb-2">Ethnicity Category:</label>
                        <select id="eth_cd" class="w-full px-4 py-3 border border-slate-300 rounded-xl focus:ring-2 focus:ring-primary-500 focus:border-primary-500 transition-all duration-300">
                            <option value="1">Akan</option>
                            <option value="2">Ga</option>
                            <option value="3">Ewe</option>
                            <option value="4">Northern</option>
                            <option value="5">Other West African</option>
                            <option value="6">Other African</option>
                            <option value="7">European/Asian/American</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="ses" class="block text-sm font-semibold text-slate-700 mb-2">Socioeconomic Status:</label>
                        <select id="ses" class="w-full px-4 py-3 border border-slate-300 rounded-xl focus:ring-2 focus:ring-primary-500 focus:border-primary-500 transition-all duration-300">
                            <option value="1">Low</option>
                            <option value="2">Medium</option>
                            <option value="3">High</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="act" class="block text-sm font-semibold text-slate-700 mb-2">Activity Level (0 = Sedentary, 1 = Active):</label>
                        <input type="number" id="act" value="1" min="0" max="1" class="w-full px-4 py-3 border border-slate-300 rounded-xl focus:ring-2 focus:ring-primary-500 focus:border-primary-500 transition-all duration-300">
                    </div>
                    
                    <div class="form-group">
                        <label for="trd" class="block text-sm font-semibold text-slate-700 mb-2">Traditional Occupation Classification:</label>
                        <select id="trd" class="w-full px-4 py-3 border border-slate-300 rounded-xl focus:ring-2 focus:ring-primary-500 focus:border-primary-500 transition-all duration-300">
                            <option value="1">Sedentary</option>
                            <option value="2">Manual</option>
                            <option value="3">Sporting</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="fmh" class="block text-sm font-semibold text-slate-700 mb-2">Family History of Prostate Cancer:</label>
                        <select id="fmh" class="w-full px-4 py-3 border border-slate-300 rounded-xl focus:ring-2 focus:ring-primary-500 focus:border-primary-500 transition-all duration-300">
                            <option value="0">No</option>
                            <option value="1">Yes</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="alc" class="block text-sm font-semibold text-slate-700 mb-2">Alcohol Use:</label>
                        <select id="alc" class="w-full px-4 py-3 border border-slate-300 rounded-xl focus:ring-2 focus:ring-primary-500 focus:border-primary-500 transition-all duration-300">
                            <option value="0">None</option>
                            <option value="1">Moderate</option>
                            <option value="2">Heavy</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="tbc" class="block text-sm font-semibold text-slate-700 mb-2">Tobacco Use:</label>
                        <select id="tbc" class="w-full px-4 py-3 border border-slate-300 rounded-xl focus:ring-2 focus:ring-primary-500 focus:border-primary-500 transition-all duration-300">
                            <option value="0">None</option>
                            <option value="1">Former</option>
                            <option value="2">Current</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="dre_l" class="block text-sm font-semibold text-slate-700 mb-2">DRE Localized Disease:</label>
                        <select id="dre_l" class="w-full px-4 py-3 border border-slate-300 rounded-xl focus:ring-2 focus:ring-primary-500 focus:border-primary-500 transition-all duration-300">
                            <option value="0">Advanced</option>
                            <option value="1">Localized</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="hpsa_cd" class="block text-sm font-semibold text-slate-700 mb-2">Highest PSA Value Recorded:</label>
                        <input type="number" id="hpsa_cd" value="5" min="0" class="w-full px-4 py-3 border border-slate-300 rounded-xl focus:ring-2 focus:ring-primary-500 focus:border-primary-500 transition-all duration-300">
                    </div>
                    
                    <div class="form-group">
                        <label for="natg" class="block text-sm font-semibold text-slate-700 mb-2">Number of Adjuvant Treatment Modalities Given:</label>
                        <input type="number" id="natg" value="1" min="0" class="w-full px-4 py-3 border border-slate-300 rounded-xl focus:ring-2 focus:ring-primary-500 focus:border-primary-500 transition-all duration-300">
                    </div>
                    
                    <div class="form-group">
                        <label for="tmg" class="block text-sm font-semibold text-slate-700 mb-2">Total Number of Treatment Modalities Given:</label>
                        <input type="number" id="tmg" value="2" min="0" class="w-full px-4 py-3 border border-slate-300 rounded-xl focus:ring-2 focus:ring-primary-500 focus:border-primary-500 transition-all duration-300">
                    </div>
                    
                    <div class="form-group">
                        <label for="weight" class="block text-sm font-semibold text-slate-700 mb-2">Weight (kg):</label>
                        <input type="number" id="weight" value="75" min="1" class="w-full px-4 py-3 border border-slate-300 rounded-xl focus:ring-2 focus:ring-primary-500 focus:border-primary-500 transition-all duration-300">
                    </div>
                    
                    <div class="form-group">
                        <label for="height" class="block text-sm font-semibold text-slate-700 mb-2">Height (m):</label>
                        <input type="number" id="height" value="1.75" min="0.1" step="0.01" class="w-full px-4 py-3 border border-slate-300 rounded-xl focus:ring-2 focus:ring-primary-500 focus:border-primary-500 transition-all duration-300">
                    </div>
                    
                    <div class="form-group">
                        <label for="bmi_cd" class="block text-sm font-semibold text-slate-700 mb-2">BMI Category:</label>
                        <select id="bmi_cd" disabled class="w-full px-4 py-3 border border-slate-300 rounded-xl bg-slate-100 text-slate-600">
                            <option value="1">Underweight</option>
                            <option value="2">Normal</option>
                            <option value="3">Overweight</option>
                            <option value="4">Obese</option>
                        </select>
                        <div id="bmi-result" class="mt-2 text-sm text-slate-600"></div>
                    </div>
                </div>
                
                <button type="button" class="w-full mt-8 bg-gradient-to-r from-rose-500 to-rose-600 hover:from-rose-600 hover:to-rose-700 text-white font-semibold py-4 px-8 rounded-xl shadow-lg hover:shadow-xl transition-all duration-300 transform hover:-translate-y-1" id="predict-button">
                    Predict Risk
                </button>
            </form>
        </div>
    </div>

    <!-- Modal -->
    <div id="result-modal" class="fixed inset-0 bg-black bg-opacity-50 backdrop-blur-sm z-50 flex items-center justify-center opacity-0 pointer-events-none transition-all duration-500 ease-in-out">
        <div class="bg-white rounded-2xl shadow-2xl p-8 max-w-2xl w-full mx-4 max-h-[90vh] overflow-y-auto transform scale-95 transition-transform duration-300">
            <div class="flex items-center justify-between mb-6">
                <h2 class="text-2xl font-bold bg-gradient-to-r from-rose-600 to-rose-700 bg-clip-text text-transparent">Prediction Results</h2>
                <button id="close-modal" class="text-slate-400 hover:text-slate-600 transition-colors duration-200">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                    </svg>
                </button>
            </div>
            
            <div class="space-y-6">
                <div class="bg-slate-50 rounded-xl p-6">
                    <p id="risk-text" class="text-lg font-semibold text-slate-800 mb-2"></p>
                    <p id="interpretation-text" class="text-slate-600"></p>
                </div>
                
                <div>
                    <h4 class="text-lg font-semibold text-slate-800 mb-4">Recommendations for Urologists:</h4>
                    <ul id="uro-recommendations" class="space-y-2 text-slate-600"></ul>
                </div>
                
                <div>
                    <h4 class="text-lg font-semibold text-slate-800 mb-4">Recommendations for Patients:</h4>
                    <ul id="patient-recommendations" class="space-y-2 text-slate-600"></ul>
                </div>
            </div>
        </div>
    </div>

    <!-- Loading Overlay -->
    <div id="loadingOverlay" class="fixed inset-0 bg-white bg-opacity-95 backdrop-blur-sm z-50 flex items-center justify-center opacity-0 pointer-events-none transition-all duration-500 ease-in-out">
        <div class="text-center">
            <div class="relative mb-6">
                <div class="w-20 h-20 mx-auto bg-gradient-to-br from-primary-500 to-secondary-500 rounded-full flex items-center justify-center animate-pulse shadow-2xl">
                    <svg class="w-10 h-10 text-white animate-bounce" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"></path>
                    </svg>
                </div>
                <div class="absolute inset-0 w-20 h-20 mx-auto border-4 border-transparent border-t-primary-500 rounded-full animate-spin"></div>
            </div>
            <h3 class="text-xl font-semibold text-slate-800 mb-2">Loading Health Tool</h3>
            <p class="text-slate-600">Preparing your wellness companion...</p>
            <div class="w-64 h-2 bg-slate-200 rounded-full mt-4 mx-auto overflow-hidden">
                <div id="progressBar" class="h-full bg-gradient-to-r from-primary-500 to-secondary-500 rounded-full transform -translate-x-full transition-transform duration-2000 ease-out"></div>
            </div>
        </div>
    </div>

    <script>
        // All the original JavaScript functionality preserved
        const coefficients = {
            intercept: 2.357,
            comorbs: -1.305,
            age_cd: -0.518,
            eth_cd: -0.05,
            ses: -0.156,
            act: 0.385,
            trd: -0.074,
            weight: 0.012,
            height: 0.427,
            bmi_cd: -0.059,
            hpsa_cd: -0.272,
            fmh: 0.2,
            alc: -0.1,
            tbc: 0.15,
            dre_l: 0.5,
            natg: 0.08,
            tmg: -0.05
        };

        function calculateRisk(inputs) {
            const logOdds = coefficients.intercept +
                coefficients.comorbs * inputs.comorbs +
                coefficients.age_cd * inputs.age_cd +
                coefficients.eth_cd * inputs.eth_cd +
                coefficients.ses * inputs.ses +
                coefficients.act * inputs.act +
                coefficients.trd * inputs.trd +
                coefficients.weight * inputs.weight +
                coefficients.height * inputs.height +
                coefficients.bmi_cd * inputs.bmi_cd +
                coefficients.hpsa_cd * inputs.hpsa_cd +
                coefficients.fmh * inputs.fmh +
                coefficients.alc * inputs.alc +
                coefficients.tbc * inputs.tbc +
                coefficients.dre_l * inputs.dre_l +
                coefficients.natg * inputs.natg +
                coefficients.tmg * inputs.tmg;

            const probability = 1 / (1 + Math.exp(-logOdds));
            return probability;
        }

        function getRecommendations(risk) {
            if (risk < 0.2) {
                return {
                    category: "Low Risk",
                    interpretation: "Low risk of toxicity.",
                    uro: [
                        "1. Routine Surveillance Protocol: Establish a protocol for regular follow-ups that includes PSA tests and DRE every 12 months.",
                        "2. Patient Education: Provide patients with educational materials regarding prostate health.",
                        "3. Risk Assessment: Continuously assess patients' risk profiles during visits.",
                        "4. Communication: Maintain open communication channels with patients.",
                        "5. Support Resources: Recommend support groups and resources."
                    ],
                    patient: [
                        "1. Routine Monitoring: Continue with regular follow-ups, including PSA tests and DRE.",
                        "2. Healthy Lifestyle: Maintain a balanced diet rich in fruits and vegetables.",
                        "3. Limit Alcohol: Reduce alcohol intake and avoid smoking.",
                        "4. Stay Active: Engage in regular physical activity.",
                        "5. Ask Questions: Be proactive in discussing any concerns."
                    ]
                };
            } else if (risk < 0.5) {
                return {
                    category: "Moderate Risk",
                    interpretation: "Moderate risk of toxicity.",
                    uro: [
                        "1. Enhanced Monitoring: Schedule more frequent visits, ideally every 6 months, to monitor PSA levels.",
                        "2. Lifestyle Counseling: Discuss lifestyle modifications that can lower risk, including diet and exercise.",
                        "3. Consider Further Testing: Evaluate the need for additional tests such as MRI or biopsy based on PSA trends.",
                        "4. Patient Education: Provide tailored education based on individual risk factors.",
                        "5. Discuss Treatment Options: Engage in discussions regarding treatment options based on individual circumstances."
                    ],
                    patient: [
                        "1. Regular Follow-Ups: Ensure to attend all scheduled appointments for monitoring.",
                        "2. Diet and Exercise: Incorporate a healthy diet and regular exercise into your routine.",
                        "3. Discuss Changes: Report any changes in health or new symptoms to your healthcare provider.",
                        "4. Be Proactive: Stay informed about prostate health and treatment options.",
                        "5. Ask Questions: Don't hesitate to ask your healthcare provider any questions or express concerns."
                    ]
                };
            } else {
                return {
                    category: "High Risk",
                    interpretation: "High risk of toxicity.",
                    uro: [
                        "1. Aggressive Monitoring: Schedule follow-ups every 3 months for close monitoring of PSA levels.",
                        "2. Discuss Treatment Plans: Immediate discussions regarding potential treatment options, including surgery, radiation, or hormonal therapy.",
                        "3. Multidisciplinary Approach: Consider referral to a multidisciplinary team for comprehensive care.",
                        "4. Patient Support: Provide information on mental health resources and support systems for patients.",
                        "5. Comprehensive Risk Assessment: Continuously assess other risk factors and adjust management plans accordingly."
                    ],
                    patient: [
                        "1. Attend All Appointments: Make sure to attend all scheduled follow-ups to monitor your health closely.",
                        "2. Open Communication: Discuss treatment options and any concerns with your healthcare provider.",
                        "3. Support Systems: Seek support from family, friends, or support groups.",
                        "4. Lifestyle Adjustments: Focus on a healthy lifestyle and adhere to your healthcare provider's recommendations.",
                        "5. Stay Informed: Educate yourself about your condition and treatment options."
                    ]
                };
            }
        }

        function calculateBMI() {
            const weight = parseFloat(document.getElementById('weight').value);
            const height = parseFloat(document.getElementById('height').value);
            const bmiDropdown = document.getElementById('bmi_cd');
            const bmiResult = document.getElementById('bmi-result');

            if (!weight || !height || weight <= 0 || height <= 0) {
                bmiResult.textContent = "Invalid input.";
                bmiDropdown.value = "";
                return;
            }

            const bmi = weight / (height ** 2);
            let interpretation = "";

            if (bmi < 18.5) {
                bmiDropdown.value = "1";
                interpretation = "Underweight";
            } else if (bmi < 24.9) {
                bmiDropdown.value = "2";
                interpretation = "Normal";
            } else if (bmi < 29.9) {
                bmiDropdown.value = "3";
                interpretation = "Overweight";
            } else {
                bmiDropdown.value = "4";
                interpretation = "Obese";
            }

            bmiResult.textContent = `BMI: ${bmi.toFixed(1)} (${interpretation})`;
        }

        // Event listeners
        document.getElementById('weight').addEventListener('input', calculateBMI);
        document.getElementById('height').addEventListener('input', calculateBMI);

        document.getElementById("predict-button").addEventListener("click", function () {
            const inputs = {
                comorbs: parseFloat(document.getElementById("comorbs").value),
                age_cd: parseFloat(document.getElementById("age_cd").value),
                eth_cd: parseFloat(document.getElementById("eth_cd").value),
                ses: parseFloat(document.getElementById("ses").value),
                act: parseFloat(document.getElementById("act").value),
                trd: parseFloat(document.getElementById("trd").value),
                weight: parseFloat(document.getElementById("weight").value),
                height: parseFloat(document.getElementById("height").value),
                bmi_cd: parseFloat(document.getElementById("bmi_cd").value),
                hpsa_cd: parseFloat(document.getElementById("hpsa_cd").value),
                fmh: parseFloat(document.getElementById("fmh").value),
                alc: parseFloat(document.getElementById("alc").value),
                tbc: parseFloat(document.getElementById("tbc").value),
                dre_l: parseFloat(document.getElementById("dre_l").value),
                natg: parseFloat(document.getElementById("natg").value),
                tmg: parseFloat(document.getElementById("tmg").value)
            };

            const risk = calculateRisk(inputs);
            const recommendations = getRecommendations(risk);

            document.getElementById("risk-text").innerText = `Predicted Probability of Toxicity Risk: ${(risk * 100).toFixed(2)}% (${recommendations.category})`;
            document.getElementById("interpretation-text").innerText = recommendations.interpretation;

            const uroList = document.getElementById("uro-recommendations");
            const patientList = document.getElementById("patient-recommendations");

            uroList.innerHTML = recommendations.uro.map(item => `<li class="flex items-start space-x-2"><span class="w-2 h-2 bg-primary-500 rounded-full mt-2 flex-shrink-0"></span><span>${item}</span></li>`).join("");
            patientList.innerHTML = recommendations.patient.map(item => `<li class="flex items-start space-x-2"><span class="w-2 h-2 bg-success-500 rounded-full mt-2 flex-shrink-0"></span><span>${item}</span></li>`).join("");

            const modal = document.getElementById("result-modal");
            modal.classList.remove('opacity-0', 'pointer-events-none');
            modal.classList.add('opacity-100');
            modal.querySelector('.bg-white').classList.remove('scale-95');
            modal.querySelector('.bg-white').classList.add('scale-100');
        });

        document.getElementById("close-modal").addEventListener("click", function () {
            const modal = document.getElementById("result-modal");
            modal.classList.add('opacity-0', 'pointer-events-none');
            modal.classList.remove('opacity-100');
            modal.querySelector('.bg-white').classList.add('scale-95');
            modal.querySelector('.bg-white').classList.remove('scale-100');
        });

        window.addEventListener("click", function (event) {
            const modal = document.getElementById("result-modal");
            if (event.target === modal) {
                modal.classList.add('opacity-0', 'pointer-events-none');
                modal.classList.remove('opacity-100');
                modal.querySelector('.bg-white').classList.add('scale-95');
                modal.querySelector('.bg-white').classList.remove('scale-100');
            }
        });

        // Page transition functionality
        class PageTransition {
            constructor() {
                this.overlay = document.getElementById('loadingOverlay');
                this.progressBar = document.getElementById('progressBar');
                this.init();
            }

            init() {
                const navLinks = document.querySelectorAll('a[href$=".html"]');
                navLinks.forEach(link => {
                    link.addEventListener('click', (e) => this.handleLinkClick(e));
                });

                window.addEventListener('pageshow', (e) => {
                    if (e.persisted) {
                        this.hideLoading();
                    }
                });

                window.addEventListener('load', () => {
                    this.hideLoading();
                });
            }

            handleLinkClick(e) {
                const link = e.currentTarget;
                const href = link.getAttribute('href');
                
                if (href.startsWith('http') || href.startsWith('#')) {
                    return;
                }

                e.preventDefault();
                this.showLoading();
                
                setTimeout(() => {
                    window.location.href = href;
                }, 1500);
            }

            showLoading() {
                this.overlay.classList.remove('opacity-0', 'pointer-events-none');
                this.overlay.classList.add('opacity-100');
                
                setTimeout(() => {
                    this.progressBar.classList.remove('-translate-x-full');
                    this.progressBar.classList.add('translate-x-0');
                }, 100);

                document.body.style.overflow = 'hidden';
            }

            hideLoading() {
                this.overlay.classList.remove('opacity-100');
                this.overlay.classList.add('opacity-0', 'pointer-events-none');
                
                this.progressBar.classList.remove('translate-x-0');
                this.progressBar.classList.add('-translate-x-full');

                document.body.style.overflow = '';
            }
        }

        document.addEventListener('DOMContentLoaded', () => {
            new PageTransition();
            calculateBMI();
            
            // Page fade-in animation
            const container = document.querySelector('.container');
            const header = document.querySelector('header');
            
            [container, header].forEach(element => {
                if (element) {
                    element.style.opacity = '0';
                    element.style.transform = 'translateY(20px)';
                    element.style.transition = 'opacity 0.6s ease-out, transform 0.6s ease-out';
                }
            });

            setTimeout(() => {
                [header, container].forEach((element, index) => {
                    if (element) {
                        setTimeout(() => {
                            element.style.opacity = '1';
                            element.style.transform = 'translateY(0)';
                        }, index * 200);
                    }
                });
            }, 100);
        });
    </script>
</body>
</html>
